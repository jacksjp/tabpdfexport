<!DOCTYPE html>
<html>

<head>
	<title> export to PDF </title>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
	<script type="text/javascript">
		
		var fname;
		var ftype;

		printfun = function(){
			// parent.parent.window.print();
			// console.log(parent.parent.window);
			console.log(window.parent.location.pathname);
			var url = window.parent.location.pathname;
			if(fname){
			var srcurl = window.parent.location.protocol + '//' + window.parent.location.hostname + window.parent.location.pathname + '.pdf?' + fname + '=' + ftype[0].value;
			}
			else{
				var srcurl = window.parent.location.protocol + '//' + window.parent.location.hostname + window.parent.location.pathname + '.pdf?'	
			}
			window.alert(srcurl);
			 var req = new XMLHttpRequest();
			  req.open("GET", srcurl, true);
			  req.responseType = "blob";

			  req.onload = function (event) {
				var blob = req.response;
				console.log(blob.size);
				var link=document.createElement('a');
				link.href=window.URL.createObjectURL(blob);
				link.download="new" + new Date() + ".pdf";
				link.click();
			  };

  req.send();
		}
		
		getTableau = function() {
        	return parent.parent.tableau;
        }
                                
                                getCurrentViz = function() {
                                                return getTableau().VizManager.getVizs()[0];
                                }
                                
                                getCurrentWorkbook = function() {
                                                return getCurrentViz().getWorkbook();
                                }
								function initViz() {
                                                tableau = getTableau();
                                                workbook = getCurrentWorkbook();
                                                viz = getCurrentViz();
												// worksheet = workbook.getActiveSheet();
												// console.log(worksheet);
												viz.addEventListener('filterchange', onFilterChange);
												/*worksheet.getWorksheets().get('Sale Map').getFiltersAsync()
												.then(function(val){
													console.log(val);
												}) */
												console.log(viz);
                                }
								function onFilterChange(filterEvent) {

filterEvent.getFilterAsync().then(reportSelectedFilter);

}



function reportSelectedFilter(field) {
fname = field.getFieldName();
ftype = field.getAppliedValues();
console.log(fname,ftype);
}



function listenToFilterSelection(viz) {

viz.addEventListener('filterchange', onFilterChange);

}

		</script>
</head>
<body onload="initViz();">
	<button id="myBtn" onclick="printfun();"> print screen </button>
</body>
</html>